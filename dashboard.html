<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard â€” CricAnalytics Pro</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <div class="app-wrapper">
        <!-- SIDEBAR -->
        <nav class="sidebar" id="sidebar">
            <button class="sidebar-close" id="sidebar-close">âœ•</button>
            <div class="sidebar-logo">
                <span class="cricket-emoji">ğŸ</span>
                <div class="logo-text">CricAnalytics</div>
                <div class="logo-sub">Pro Edition</div>
            </div>
            <div class="sidebar-nav">
                <div class="nav-section-title">Main</div>
                <a class="nav-item" href="dashboard.html"><span class="nav-icon">ğŸ </span> Dashboard</a>
                <a class="nav-item" href="add-match.html"><span class="nav-icon">â•</span> Add Match</a>
                <a class="nav-item" href="match-history.html"><span class="nav-icon">ğŸ“‹</span> Match History</a>
                <div class="nav-section-title">Analysis</div>
                <a class="nav-item" href="analysis.html"><span class="nav-icon">ğŸ“Š</span> Performance Analysis</a>
                <a class="nav-item" href="players.html"><span class="nav-icon">ğŸ‘¥</span> All Players</a>
                <div class="nav-section-title">Account</div>
                <a class="nav-item" id="nav-logout" href="#" onclick="handleLogout()"><span class="nav-icon">ğŸšª</span>
                    Logout</a>
            </div>
            <div class="sidebar-footer">
                <a class="admin-btn" href="admin.html">ğŸ”’ Admin Panel</a>
            </div>
        </nav>

        <div class="main-content">
            <div class="topbar">
                <div style="display:flex;align-items:center;gap:12px">
                    <button class="hamburger" id="hamburger">â˜°</button>
                    <h1>ğŸ  Dashboard</h1>
                </div>
                <div class="topbar-right">
                    <span id="topbar-date" style="font-size:0.8rem;color:var(--text-muted)"></span>
                    <a href="add-match.html" class="btn btn-gold btn-sm no-print">â• Add Match</a>
                </div>
            </div>

            <div class="page-content">
                <!-- Profile Header -->
                <div class="profile-header" id="profile-header">
                    <div class="profile-avatar" id="profile-avatar">?</div>
                    <div class="profile-info">
                        <h2 id="player-name">â€”</h2>
                        <div class="profile-meta">
                            <span class="badge badge-gold" id="badge-type">â€”</span>
                            <span class="badge badge-green" id="badge-role">â€”</span>
                            <span class="badge badge-blue" id="badge-mobile">â€”</span>
                        </div>
                    </div>
                    <div style="margin-left:auto;display:flex;gap:10px;flex-wrap:wrap" class="no-print">
                        <button class="btn btn-outline btn-sm" onclick="window.print()">ğŸ–¨ï¸ Print</button>
                        <button class="btn btn-ghost btn-sm" id="btn-export-txt">ğŸ“¥ Export</button>
                    </div>
                </div>

                <!-- MOTM Trophy area -->
                <div id="motm-section" style="display:none;margin-bottom:24px">
                    <div class="glass-card glass-card-gold"
                        style="padding:16px 24px;display:flex;align-items:center;gap:16px">
                        <span class="trophy-anim" style="font-size:2.2rem">ğŸ†</span>
                        <div>
                            <div style="font-size:1rem;font-weight:800;color:var(--accent-gold)" id="motm-text">0 Man of
                                the Match Awards</div>
                            <div style="font-size:0.78rem;color:var(--text-muted)">Keep up the great performances!</div>
                        </div>
                    </div>
                </div>

                <!-- BATTING STATS -->
                <div class="d-flex-between mb-3">
                    <h3
                        style="font-size:0.85rem;font-weight:700;color:var(--text-muted);letter-spacing:1.5px;text-transform:uppercase">
                        ğŸ Batting Career</h3>
                </div>
                <div class="stats-grid" id="bat-stats-grid"></div>

                <!-- BOWLING STATS -->
                <div class="d-flex-between mb-3 mt-3">
                    <h3
                        style="font-size:0.85rem;font-weight:700;color:var(--text-muted);letter-spacing:1.5px;text-transform:uppercase">
                        ğŸ¯ Bowling Career</h3>
                </div>
                <div class="stats-grid" id="bowl-stats-grid"></div>

                <!-- FIELDING STATS -->
                <div class="d-flex-between mb-3 mt-3">
                    <h3
                        style="font-size:0.85rem;font-weight:700;color:var(--text-muted);letter-spacing:1.5px;text-transform:uppercase">
                        ğŸ§¤ Fielding Career</h3>
                </div>
                <div class="stats-grid" id="field-stats-grid"></div>

                <!-- CHARTS ROW -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:28px" class="no-print"
                    id="charts-row">
                    <div class="chart-container">
                        <div
                            style="font-size:0.8rem;font-weight:700;color:var(--text-muted);margin-bottom:12px;text-transform:uppercase;letter-spacing:1px">
                            ğŸ“Š Runs â€” Last 5 Matches</div>
                        <canvas id="chart-runs"></canvas>
                    </div>
                    <div class="chart-container">
                        <div
                            style="font-size:0.8rem;font-weight:700;color:var(--text-muted);margin-bottom:12px;text-transform:uppercase;letter-spacing:1px">
                            ğŸ“ˆ Wickets â€” Last 5 Matches</div>
                        <canvas id="chart-wickets"></canvas>
                    </div>
                </div>

                <!-- RECENT MATCHES -->
                <div class="glass-card" style="margin-top:24px">
                    <div class="card-header">
                        <h2>ğŸ“‹ Recent Matches</h2>
                        <a href="match-history.html" class="btn btn-ghost btn-sm no-print">View All</a>
                    </div>
                    <div class="card-body" style="padding:0">
                        <div class="table-container">
                            <table id="recent-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Tournament</th>
                                        <th>Type</th>
                                        <th>Runs</th>
                                        <th>Wkts</th>
                                        <th>Catches</th>
                                        <th>MOTM</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-tbody"></tbody>
                            </table>
                        </div>
                        <div id="no-matches-msg" style="display:none" class="empty-state">
                            <div class="empty-icon">ğŸ</div>
                            <h3>No matches yet</h3>
                            <p>Add your first match to start tracking performance</p>
                            <a href="add-match.html" class="btn btn-gold">â• Add First Match</a>
                        </div>
                    </div>
                </div>

            </div><!-- /page-content -->
        </div><!-- /main-content -->
    </div>

    <!-- Mobile Bottom Nav -->
    <nav class="mobile-bottom-nav">
        <a href="dashboard.html" class="active"><span class="mbn-icon">ğŸ </span>Dashboard</a>
        <a href="add-match.html"><span class="mbn-icon">â•</span>Add Match</a>
        <a href="match-history.html"><span class="mbn-icon">ğŸ“‹</span>History</a>
        <a href="analysis.html"><span class="mbn-icon">ğŸ“Š</span>Analysis</a>
        <a href="players.html"><span class="mbn-icon">ğŸ‘¥</span>Players</a>
    </nav>

    <div id="toast-container" class="toast-container"></div>
    <script src="app.js"></script>
    <script src="charts.js"></script>
    <script>
        requireLogin();

        const player = getCurrentPlayer();
        const mobile = player.mobile;
        const stats = calcStats(mobile);

        // Topbar date
        document.getElementById('topbar-date').textContent = new Date().toLocaleDateString('en-IN', { weekday: 'short', day: '2-digit', month: 'short', year: 'numeric' });

        // Profile
        document.getElementById('player-name').textContent = player.name;
        document.getElementById('profile-avatar').textContent = initials(player.name);
        document.getElementById('badge-type').textContent = 'ğŸ ' + player.matchType;
        document.getElementById('badge-role').textContent = player.role;
        document.getElementById('badge-mobile').textContent = 'ğŸ“± ' + player.mobile;

        // MOTM
        if (stats.bat.motm > 0) {
            document.getElementById('motm-section').style.display = 'block';
            document.getElementById('motm-text').textContent = `${stats.bat.motm} Man of the Match Award${stats.bat.motm > 1 ? 's' : ''}`;
        }

        // Export
        document.getElementById('btn-export-txt').addEventListener('click', () => exportToText(mobile));

        // Stat card helper
        function statCard(label, value, cls = '', extraClass = '') {
            return `<div class="stat-card ${extraClass}">
    <div class="stat-label">${label}</div>
    <div class="stat-value ${cls}">${value}</div>
  </div>`;
        }

        // Batting
        document.getElementById('bat-stats-grid').innerHTML = [
            statCard('Matches', stats.bat.total, 'gold'),
            statCard('Total Runs', stats.bat.runs, 'gold'),
            statCard('Highest Score', stats.bat.highest, ''),
            statCard('Batting Avg', stats.avg, 'gold'),
            statCard('Strike Rate', stats.sr, ''),
            statCard('Total 4s', stats.bat.fours, '', 'green'),
            statCard('Total 6s', stats.bat.sixes, 'green', 'green'),
            statCard('50s', stats.bat.fifties, ''),
            statCard('100s', stats.bat.hundreds, 'gold'),
        ].join('');

        // Bowling
        document.getElementById('bowl-stats-grid').innerHTML = [
            statCard('Wickets', stats.bowl.wickets, 'green', 'green'),
            statCard('Best Bowling', stats.bestBowl, 'green'),
            statCard('Economy', stats.eco, ''),
            statCard('Bowl Avg', stats.ba, ''),
            statCard('Maidens', stats.bowl.maidens, '', 'green'),
            statCard('Wides', stats.bowl.wides, '', 'red'),
        ].join('');

        // Fielding
        document.getElementById('field-stats-grid').innerHTML = [
            statCard('Catches', stats.field.catches, '', 'green'),
            statCard('Run Outs', stats.field.runouts, 'green'),
            statCard('Stumpings', stats.field.stumpings, '', 'purple'),
        ].join('');

        // Recent matches table
        const matches = getMatchesByPlayer(mobile).slice(0, 5);
        const tbody = document.getElementById('recent-tbody');
        if (!matches.length) {
            document.querySelector('#recent-table').style.display = 'none';
            document.getElementById('no-matches-msg').style.display = 'block';
        } else {
            tbody.innerHTML = matches.map(m => `
    <tr>
      <td>${fmtDate(m.matchDate)}</td>
      <td class="highlight">${m.tournament || '-'}</td>
      <td><span class="badge badge-blue">${m.matchType}</span></td>
      <td class="gold">${m.runs || 0}(${m.balls || 0})</td>
      <td class="green">${m.wickets || 0}/${m.bRuns || 0}</td>
      <td>${m.catches || 0}</td>
      <td>${m.motm ? 'ğŸ†' : '-'}</td>
    </tr>`).join('');
        }

        // Charts
        const lastFive = getLastNMatches(mobile, 5);
        const chartLabels = lastFive.map(m => fmtDate(m.matchDate).slice(0, 6));
        const runsArr = lastFive.map(m => parseInt(m.runs) || 0);
        const wktsArr = lastFive.map(m => parseInt(m.wickets) || 0);
        setTimeout(() => {
            drawBarChart('chart-runs', chartLabels, runsArr, '#c8860a');
            drawLineChart('chart-wickets', chartLabels, wktsArr, '#1a9b75');
        }, 50);

        function handleLogout() {
            clearCurrentPlayer();
            window.location.href = 'index.html';
        }
    </script>
</body>

</html>